# 08-通知公告

通知公告模块是OA系统中用于发布重要信息和通知的核心功能，支持通知的创建、发布、管理和查看等全流程操作。

## 8.1 模块概述

### 8.1.1 功能特性
- 通知创建与编辑
- 通知发布与推送
- 通知状态管理
- 通知转发功能
- 通知查看与标记
- 权限控制机制

### 8.1.2 通知类型
- 系统通知：系统自动生成的通知
- 部门通知：针对特定部门的通知
- 全员通知：面向全体员工的通知
- 个人通知：个人定向通知

### 8.1.3 通知状态
| 状态码 | 状态名称 | 说明 |
|--------|----------|------|
| 0 | 草稿 | 通知尚未发布 |
| 1 | 已发布 | 通知已发布并推送 |
| 2 | 已撤回 | 通知已被撤回 |

## 8.2 通知管理

### 8.2.1 通知管理面板
**访问路径**：`/infrommanage`

通知管理面板提供以下功能：
- 查看个人发布的所有通知
- 支持分页显示
- 提供编辑和删除操作
- 显示通知基本信息和状态

**界面要素**：
- 通知标题列表
- 发布时间显示
- 通知状态标识
- 操作按钮（编辑、删除）

### 8.2.2 创建/编辑通知
**访问路径**：`/informedit`

#### 创建新通知
1. 点击"新建通知"按钮
2. 填写通知信息：
   - **通知标题**：简洁明确的标题
   - **通知内容**：详细的通知正文
   - **通知类型**：选择合适的通知类型
   - **通知状态**：设置发布状态
3. 点击"保存"创建通知

#### 编辑现有通知
1. 在通知列表中点击"编辑"
2. 修改通知内容
3. 保存更改

**表单验证**：
- 标题不能为空
- 内容长度限制
- 类型必须选择
- 状态必须指定

### 8.2.3 通知删除
**访问路径**：`/infromdelete`

**删除规则**：
- 只能删除自己创建的通知
- 已发布的通知删除需谨慎
- 删除操作不可撤销

**权限验证**：
```java
// 验证通知创建者
if (!Objects.equals(userId, notice.getUserId())) {
    return "redirect:/notlimit"; // 无权限访问
}
```

## 8.3 通知推送机制

### 8.3.1 自动推送
通知创建后会自动推送给相关用户：
- 系统根据用户层级关系确定推送范围
- 通过`NoticeUserRelation`表建立用户与通知的关系
- 推送给发布者的所有下级用户

### 8.3.2 转发功能
**访问路径**：`/forwardother`

管理员可以将通知转发给其他用户：
```java
// 转发逻辑
List<User> users = uDao.findByFatherId(userId);
for (User user : users) {
    nurs.add(new NoticeUserRelation(nl, user, false));
}
```

## 8.4 通知接收与查看

### 8.4.1 通知列表
**访问路径**：`/infromlist`

用户通知列表功能：
- 显示接收到的所有通知
- 区分已读/未读状态
- 支持时间排序
- 提供搜索功能

### 8.4.2 通知查看
**访问路径**：`/informshow`

查看通知详情：
1. 点击通知标题进入详情页
2. 系统自动标记为已读
3. 显示通知完整内容
4. 显示发布者信息

**已读标记逻辑**：
```java
if (("0").equals(req.getParameter("read"))) {
    Long relationId = Long.parseLong(req.getParameter("relationid"));
    NoticeUserRelation relation = informrelationDao.findOne(relationId);
    relation.setRead(true);
    informrelationService.save(relation);
}
```

### 8.4.3 通知搜索与过滤
**访问路径**：`/informlistpaging`

支持多种搜索条件：
- **关键词搜索**：按标题和内容搜索
- **类型筛选**：按通知类型过滤
- **状态筛选**：按已读/未读状态过滤
- **时间筛选**：按发布时间排序

**搜索参数**：
- `baseKey`：关键词
- `type`：通知类型
- `status`：状态筛选
- `time`：时间排序

## 8.5 数据结构

### 8.5.1 通知实体（NoticesList）
```java
public class NoticesList {
    private Long noticeId;        // 通知ID
    private String title;         // 通知标题
    private String content;       // 通知内容
    private Long typeId;          // 类型ID
    private Long statusId;        // 状态ID
    private Long userId;          // 创建用户ID
    private Date noticeTime;      // 创建时间
    private Date modifyTime;      // 修改时间
    private Boolean top;          // 是否置顶
}
```

### 8.5.2 用户通知关系（NoticeUserRelation）
```java
public class NoticeUserRelation {
    private Long id;              // 关系ID
    private NoticesList notice;   // 通知对象
    private User user;            // 用户对象
    private Boolean read;         // 已读状态
    private Date readTime;        // 阅读时间
}
```

## 8.6 权限与安全

### 8.6.1 权限模型
- **创建权限**：所有用户可创建通知
- **编辑权限**：仅通知创建者可编辑
- **删除权限**：仅通知创建者可删除
- **查看权限**：基于推送关系确定

### 8.6.2 安全控制
- 用户只能操作自己创建的通知
- 查看权限基于用户关系链
- 防止越权访问和操作

## 8.7 最佳实践

### 8.7.1 通知编写规范
1. **标题要求**：
   - 控制在20字以内
   - 突出重点信息
   - 避免模糊描述

2. **内容要求**：
   - 结构清晰，层次分明
   - 重要信息前置
   - 包含必要的时间和地点信息

### 8.7.2 发布策略
1. **发布时机**：
   - 选择合适的发布时间
   - 考虑接收者的工作时间
   - 紧急通知及时发布

2. **推送范围**：
   - 准确选择推送对象
   - 避免无关人员接收
   - 重要通知可全员推送

## 8.8 故障排除

### 8.8.1 常见问题
1. **通知发送失败**
   - 检查推送用户关系配置
   - 确认数据库连接状态
   - 查看系统日志信息

2. **权限问题**
   - 确认用户登录状态
   - 检查用户权限配置
   - 验证操作对象所有权

3. **显示异常**
   - 检查前端模板文件
   - 确认数据格式正确性
   - 查看浏览器控制台错误

### 8.8.2 性能优化
1. **分页加载**：
   - 通知列表采用分页显示
   - 默认每页10条记录
   - 支持自定义分页大小

2. **索引优化**：
   - 在用户ID上建立索引
   - 优化时间字段查询
   - 合理使用复合索引

## 8.9 技术实现

### 8.9.1 控制器说明
- `InformController`：负责通知列表和搜索
- `InformManageController`：负责通知管理操作

### 8.9.2 关键方法
- `informService.pageThis()`：分页查询通知
- `informService.fengZhuang()`：数据封装处理
- `informRelationService.save()`：保存用户关系

通知公告模块为企业内部信息传递提供了完整的解决方案，确保重要信息能够及时、准确地传达到相关人员。